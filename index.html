<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Google Queue Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --google-blue: #4285F4;
            --google-red: #EA4335;
            --google-yellow: #FBBC05;
            --google-green: #34A853;
            --bg-color: #f8f9fa;
        }

        body {
            font-family: 'Google Sans', sans-serif;
            background-color: var(--bg-color);
            color: #202124;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden; /* Prevent body scroll */
        }

        /* --- HEADER --- */
        header {
            background-color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #dadce0;
            z-index: 10;
            flex-shrink: 0;
        }

        .logo { font-size: 1.2rem; font-weight: 500; display: flex; align-items: center; gap: 4px; }
        .g-blue { color: var(--google-blue); }
        .g-red { color: var(--google-red); }
        .g-yellow { color: var(--google-yellow); }
        .g-green { color: var(--google-green); }

        /* --- MAIN LAYOUT --- */
        main {
            display: flex;
            flex: 1;
            height: 100%;
            overflow: hidden;
            /* Default: Desktop (Row) */
            flex-direction: row; 
        }

        /* LEFT: 3D Scene */
        .scene-wrapper {
            flex: 1.5; 
            background: white;
            position: relative;
            border-right: 1px solid #dadce0;
        }
        
        canvas { display: block; width: 100%; height: 100%; outline: none; }

        #loader {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: white; color: var(--google-blue);
            display: flex; justify-content: center; align-items: center;
            z-index: 20; transition: opacity 0.5s; font-weight: 500;
        }

        /* RIGHT: Dashboard */
        .dashboard-panel {
            flex: 1;
            background: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100%;
            box-sizing: border-box;
        }

        /* --- MOBILE OPTIMIZATION (THE FIX) --- */
        @media (max-width: 768px) {
            main {
                flex-direction: column; /* Stack vertically on phones */
            }

            .scene-wrapper {
                flex: none; /* Don't grow automatically */
                height: 35vh; /* Take up exactly 35% of screen height */
                border-right: none;
                border-bottom: 1px solid #dadce0;
            }

            .dashboard-panel {
                flex: 1; /* Take remaining space */
                padding: 15px;
            }
            
            /* Make buttons bigger for touch */
            button { padding: 15px !important; }
        }

        /* Card Styling */
        .card {
            background: white;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 15px;
        }
        
        h2 { margin: 0 0 10px 0; font-size: 1rem; color: #5f6368; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700; }

        /* Inputs */
        .input-group { display: flex; gap: 10px; }
        
        input {
            padding: 10px; border: 1px solid #dadce0; border-radius: 4px;
            font-size: 1rem; width: 60px; outline: none; -webkit-appearance: none;
        }
        input:focus { border-color: var(--google-blue); border-width: 1px; box-shadow: 0 0 0 2px rgba(66,133,244,0.2); }

        /* Buttons */
        button {
            flex: 1; padding: 10px; border: none; border-radius: 4px;
            font-weight: 500; cursor: pointer; transition: 0.2s;
            font-family: 'Google Sans', sans-serif; font-size: 0.95rem;
            box-shadow: 0 1px 2px rgba(60,64,67,0.3);
        }
        
        button:active { transform: scale(0.98); }
        .btn-add { background-color: var(--google-blue); color: white; }
        .btn-serve { background-color: var(--google-green); color: white; }

        /* Queue List */
        .queue-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            border: 1px solid #dadce0;
            border-radius: 8px;
            background: #fff;
        }

        .queue-header {
            padding: 12px 16px;
            border-bottom: 1px solid #dadce0;
            background: #f1f3f4;
            border-radius: 8px 8px 0 0;
            font-weight: 500; font-size: 0.9rem;
        }

        .queue-list { 
            flex: 1; 
            overflow-y: auto; 
            padding: 10px;
            -webkit-overflow-scrolling: touch; /* Smooth scroll on iOS */
        }
        
        /* Ticket Cards */
        .ticket {
            background: white; border: 1px solid #dadce0;
            padding: 12px; margin-bottom: 8px; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center;
            position: relative; overflow: hidden;
        }
        
        .ticket::before { content: ""; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: var(--google-blue); }
        .ticket.senior { background: #fef7e0; border-color: #fce8b2; }
        .ticket.senior::before { background: var(--google-yellow); }

        .ticket-info strong { display: block; font-size: 1rem; color: #202124; }
        .ticket-info span { font-size: 0.85rem; color: #5f6368; }
        
        .priority-badge { background: var(--google-yellow); padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: bold; }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <span class="g-blue">G</span><span class="g-red">o</span><span class="g-yellow">o</span><span class="g-blue">g</span><span class="g-green">l</span><span class="g-red">e</span>
            <span style="color: #5f6368; font-weight: 400; margin-left: 5px;">Queue</span>
        </div>
        <div style="font-size: 0.8rem; color: #5f6368; font-weight: 500;">BCA '26</div>
    </header>

    <main>
        <div class="scene-wrapper">
            <div id="loader"><h2>Loading...</h2></div>
            <canvas id="canvas3d"></canvas>
        </div>

        <div class="dashboard-panel">
            
            <div class="card">
                <h2>New Entry</h2>
                <div class="input-group">
                    <input type="number" id="ageInput" placeholder="Age" value="25" inputmode="numeric">
                    <button class="btn-add" id="addBtn">Add</button>
                    <button class="btn-serve" id="serveBtn">Serve</button>
                </div>
            </div>

            <div class="queue-container">
                <div class="queue-header" id="queueHeader">Current Queue (0)</div>
                <div class="queue-list" id="queueDisplay">
                    <div style="text-align: center; margin-top: 20px; color: #9aa0a6;">
                        <p>No customers waiting</p>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script type="module">
        import { Application } from 'https://unpkg.com/@splinetool/runtime';

        const canvas = document.getElementById('canvas3d');
        const app = new Application(canvas);
        
        // --- PIXEL RATIO FIX --- 
        // Note: The Spline Application usually handles this automatically.
        // But this line ensures the canvas doesn't look blurry on Retina screens
        // if the layout changes dynamically.
        // We do not need renderer.setPixelRatio, but we need to ensure the runtime knows the size.
        
        let queue = []; 
        let tokenCounter = 101; 
        let splineLoaded = false;

        app.load('https://prod.spline.design/XZ3paSVSaiaaP2KZ/scene.splinecode')
            .then(() => {
                splineLoaded = true;
                const loader = document.getElementById('loader');
                loader.style.opacity = 0;
                setTimeout(() => loader.style.display = 'none', 500);
                updateSplineCount(0);
            });

        window.addCustomer = function() {
            const ageInput = document.getElementById('ageInput');
            const age = parseInt(ageInput.value);
            
            if(!age) { 
                ageInput.style.borderColor = '#EA4335';
                setTimeout(() => ageInput.style.borderColor = '#dadce0', 500);
                return; 
            }

            const newCustomer = { token: tokenCounter, age: age, isSenior: age >= 60 };
            tokenCounter++;

            if (queue.length === 0) {
                queue.push(newCustomer);
            } else if (newCustomer.isSenior) {
                let inserted = false;
                for (let i = 0; i < queue.length; i++) {
                    if (!queue[i].isSenior) {
                        queue.splice(i, 0, newCustomer);
                        inserted = true;
                        break;
                    }
                }
                if (!inserted) queue.push(newCustomer);
            } else {
                queue.push(newCustomer);
            }

            updateSplineCount(queue.length);
            updateDisplay();
        }

        window.serveCustomer = function() {
            if (queue.length === 0) { return; } 
            queue.shift();
            updateSplineCount(queue.length);
            updateDisplay();
        }

        function updateSplineCount(count) {
            if (!splineLoaded) return;
            try { app.setVariable('CurrentToken', count); } catch (err) {}
        }

        function updateDisplay() {
            const display = document.getElementById('queueDisplay');
            const header = document.getElementById('queueHeader');
            header.innerText = `Current Queue (${queue.length})`;

            if (queue.length === 0) {
                display.innerHTML = `
                    <div style="text-align: center; margin-top: 20px; color: #9aa0a6;">
                        <p>No customers waiting</p>
                    </div>`;
                return;
            }

            let html = '';
            queue.forEach(person => {
                if (person.isSenior) {
                    html += `
                    <div class="ticket senior">
                        <div class="ticket-info">
                            <strong>Token #${person.token}</strong>
                            <span>Age: ${person.age}</span>
                        </div>
                        <div class="priority-badge">PRIORITY</div>
                    </div>`;
                } else {
                    html += `
                    <div class="ticket">
                        <div class="ticket-info">
                            <strong>Token #${person.token}</strong>
                            <span>Age: ${person.age}</span>
                        </div>
                    </div>`;
                }
            });
            display.innerHTML = html;
        }

        document.getElementById('addBtn').onclick = window.addCustomer;
        document.getElementById('serveBtn').onclick = window.serveCustomer;
    </script>
</body>
</html>
